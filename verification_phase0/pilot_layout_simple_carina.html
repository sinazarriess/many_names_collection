<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>

<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->

<script>

var images = ["${image_url_0}", "${image_url_1}", "${image_url_2}", "${image_url_3}", "${image_url_4}"];

var names = [["${name_0_0}", "${name_0_1}", "${name_0_2}", "${name_0_3}", "${name_0_4}", "${name_0_5}", "${name_0_6}", "${name_0_7}", "${name_0_8}", "${name_0_9}", "${name_0_10}"],
        ["${name_1_0}", "${name_1_1}", "${name_1_2}", "${name_1_3}", "${name_1_4}", "${name_1_5}", "${name_1_6}", "${name_1_7}", "${name_1_8}", "${name_1_9}", "${name_1_10}"],
        ["${name_2_0}", "${name_2_1}", "${name_2_2}", "${name_2_3}", "${name_2_4}", "${name_2_5}", "${name_2_6}", "${name_2_7}", "${name_2_8}", "${name_2_9}", "${name_2_10}"],
        ["${name_3_0}", "${name_3_1}", "${name_3_2}", "${name_3_3}", "${name_3_4}", "${name_3_5}", "${name_3_6}", "${name_3_7}", "${name_3_8}", "${name_3_9}", "${name_3_10}"],
        ["${name_4_0}", "${name_4_1}", "${name_4_2}", "${name_4_3}", "${name_4_4}", "${name_4_5}", "${name_4_6}", "${name_4_7}", "${name_4_8}", "${name_4_9}", "${name_4_10}"],
        ]

String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};


function replaceEverywhere(node, search, replacement) {
    if (node.nodeType === 3) { // Node.TEXT_NODE
        var text = node.data.replaceAll(search, replacement);
        if (text != node.data) // there's a Safari bug
            node.data = text;
    } else if (node.nodeType === 1) { // Node.ELEMENT_NODE
        if (node.name) {
            node.name = node.name.replaceAll(search, replacement);
        }
        if (node.id) {
            node.id = node.id.replaceAll(search, replacement);
        }
        if (node.title) {
            node.title = node.title.replaceAll(search, replacement);
        }
        if (node.src) {
            node.src = node.src.replaceAll(search, replacement);
        }
        for (var i = 0; i < node.childNodes.length; i++) {
            replaceEverywhere(node.childNodes[i], search, replacement); // run recursive on DOM
        }
    }
};

document.addEventListener('DOMContentLoaded', function(){

    var img_form_template = document.getElementById("IMG#-form");
    img_form_template.parentNode.removeChild(img_form_template);

    var num_images = 0;
    var num_names_total = 0;

    for (var i = 0; i < images.length; i++) {

        var img = images[i].trim();
        if (img != "") {

            num_images += 1;

            img_form = img_form_template.cloneNode(true);
            replaceEverywhere(img_form, "IMG#", "IMG"+i);
            replaceEverywhere(img_form, "http://img_url_placeholder/", img);
            replaceEverywhere(img_form, "NAME_TARGET_PLACEHOLDER", names[i][0])

            document.getElementById("form_main").appendChild(img_form);

            var name_form_template = document.getElementById("IMG"+i+"-NAME#-form");
            name_form_template.parentNode.removeChild(name_form_template);

            for (var n = 1; n < names[i].length; n++) {
                var name = names[i][n].trim();
                if (name != "") {

                    num_names_total += 1;

                    name_form = name_form_template.cloneNode(true);
                    replaceEverywhere(name_form, "NAME#", "NAME"+n);
                    replaceEverywhere(name_form, "NAME_PLACEHOLDER", name);

                    document.getElementById("IMG"+i+"-form-table").appendChild(name_form);

                }
            }
        }
    }

    document.getElementById("num_names").innerHTML = num_names_total;
    document.getElementById("num_images").innerHTML = num_images;
})

function uncheck(buttons) {
    for (var i=0; i<buttons.length; i++) {
        buttons[i].checked = false;
    }
}

</script>


<style>


span.boundingbox {
    border:3px;
    border-style:solid;
    border-color:#f00;
    padding:0px;
}

.intro {
    font-size: 14pt;
}

span.defined {
  border: 1px dashed #00c;
  font-style: italic;
}


.column {
  float: left;
  padding: 20pt;
}
.left {
  width: 25%;
}
.right {
  width: 65%;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

img.picture {
  width: 100%;
  border: 4px solid #ccc;
}


.formtable, .formtable2 {
  background-color: #eee;
  width: 100%;
  border:4px solid #ccc;
  background-color: #eee;
  border-collapse: collapse;
}

.formtable th, .formtable td {
    text-align: center;
}
.formtable2 th, .formtable2 td {
    text-align: left;
}
th {
    font-weight: bold;
    font-size: 14pt;
    padding: 2pt;
}
th, .formtable td {
    border-bottom: 2px solid #ccc;
}


td.name, th.name {
    width: 20%;
}
td.name {
    font-family: monospace;
    font-size: 12pt;
}

td.rating, th.rating {
    width: 40%;
    text-align: left;
}
td.rating {
    height: 1.5vw;
}


td.type, th.type {
    width: 70%;
}
td.type {
    height: 3vw;
    visibility: hidden;
    font-size: 10pt;
    text-align: center;
}

td.color, th.color {
    width: 80%;
}


div.caption {
    width: 20%;
    padding: 3pt;
    display: inline-block;
    text-align: center;
    font-size: 12pt;
}

.required:after { content:" *"; }


/* HIDE RADIO
[type=radio] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
} */

/* IMAGE STYLES */
[type=radio] + img.type {
  cursor: pointer;
  width: 100%;
  margin: 4pt;
  margin-bottom: 10pt;
}

/* CHECKED STYLES */
[type=radio]:checked + img.type {
  outline: 8pt solid #666;
}

/* IMAGE STYLES */
[type=radio] + img.emote {
  cursor: pointer;
  height: 100%;
  margin: 2pt;
}

/* CHECKED STYLES */
[type=radio]:checked + img.emote {
  outline: 3pt solid #666;
}

div.color {
  width: 3vw;
  height: 2.5vw;
  font-size: 2vw;
  text-align: center;
  font-weight: bold;
  padding-top: .5vw;
  opacity: 1;
  display: inline-block;
  outline: 2pt solid #000;
}

/* COLOR STYLES */
[type=radio] + div.color {
  cursor: pointer;
  opacity: .2;
}

/* CHECKED STYLES */
[type=radio]:checked + div.color {
  opacity: 1;
}


</style>

<!-- Notes -->



<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects" id="form_main">

    <h2>Different names, same object?</h2>

    <p class="intro">
        We asked various people to <b><span style="color:#0020C2;">"name the real-world object that is highlighted by the red box"</span></b> in the picture.<br/>
        It seems that not all people were trying to name the same object.
        They may have misunderstood the task or misunderstood the box.<br/>
        <b><mark>Please help us identify which names were meant to name the same object.</mark></b>
    </p>

    <p class="intro">
        In this HIT you will get <span id="num_images"></span> images, for a total of <span id="num_names"></span> name comparisons.<br/>
        This batch of HITs contains quality control items. <b>Submitting too many low-quality responses will lead to being blocked or to rejections.</b>
    </p>

    <br>
    <div class="intro" style="text-align: center;">Need help?  &#10233;

        <crowd-instructions link-type="button">

            <short-summary>
                [summary here]
            </short-summary>

            <positive-example>
                [positive examples here]
            </positive-example>

            <negative-example>
                [negative examples here]
            </negative-example>

            <detailed-instructions>
                [detailed instructions here]
            </detailed-instructions>

        </crowd-instructions>
    </div>

    <div id="IMG#-form" class="row">

        <hr style="color: #aaa; background-color: #aaa; height: 5px;">

        <div class="column left">
            <img class="picture" src="http://img_url_placeholder/"/>
        </div>
        <div class="column right">
            <h3>&#9658; The target name for the highlighted object is "<span style="font-size: 14pt; font-family: monospace;color:#0020C2;">NAME_TARGET_PLACEHOLDER</span>". <br/>
            Identify the object it is likely meant to name. Then decide which of the following names were likely meant to name the exact same object.</h3> [CS]: I'd actually do 4-5 options, not 3

            <table class="formtable" id="IMG#-form-table">

                <tr>
                    <th class="name">Comparison name:</th>
                    <th class="rating">Meant to name the same object as <span style="color:#0020C2;">"NAME_TARGET_PLACEHOLDER"?</span></th>
                </tr>

                <tr id="IMG#-NAME#-form">
                    <td class="name">
                        NAME_PLACEHOLDER
                    </td>
                    <td class="rating">
                        <label><input required type="radio" name="IMG#-NAME#-rating" id="IMG#-NAME#-rating.0" value="0"/>
                            <!-- <img class="emote" name='emote0' src="http://mwestera.humanities.uva.nl/images/em-certain.png"
                                 title='This worker intended to name to the same real-world object as the worker who entered "NAME_TARGET_PLACEHOLDER".'/>-->
                             Yes.</label> &nbsp;&nbsp;
                        <label><input required type="radio" name="IMG#-NAME#-rating" id="IMG#-NAME#-rating.1" value="1"/>
                            <!-- <img class="emote" name='emote1' src="http://mwestera.humanities.uva.nl/images/em-bit-uncertain-cropped.png"
                                 title='This worker may not have intended to name the same real-world object as the worker who entered "NAME_TARGET_PLACEHOLDER".'/>
                                 -->
                             Not sure.</label> &nbsp;&nbsp;
                        <label><input required type="radio" name="IMG#-NAME#-rating" id="IMG#-NAME#-rating.2" value="2"/>
                            <!-- <img class="emote" name='emote2' src="http://mwestera.humanities.uva.nl/images/em-uncertain-cropped.png"
                                 title='This worker clearly intended to name a different real-world object than the worker who entered "NAME_TARGET_PLACEHOLDER".'/>
                                 -->
                            No.</label>
                    </td>
                </tr>
            </table>

            <br>

            <h3>&#9658; Any comments? [Optional]</h3>
            <input type="text" name="IMG#-comment" style="width:50%; font-size:16pt; padding:5pt" maxlength="100"/>

        </div>

        
    </div>

</crowd-form>
