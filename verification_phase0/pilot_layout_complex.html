<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->

<script src="//uniqueturker.myleott.com/lib.js" type="text/javascript"></script>
<script type="text/javascript">
(function(){
    var ut_id = "d3e5c8f13f9e7bd44aa3f2c5f59dbe9c";
    if (UTWorkerLimitReached(ut_id)) {
        document.getElementById('mturk_form').style.display = 'none';
        document.getElementsByTagName('body')[0].innerHTML = "You have already completed the maximum number of HITs allowed by this requester. Thanks a lot, and please click 'Return HIT' to avoid any impact on your approval rating! Sorry about this!";
    }
})();
</script>


<script>


var images = ["${image_url_0}", "${image_url_1}", "${image_url_2}", "${image_url_3}", "${image_url_4}"];

var names = [["${name_0_0}", "${name_0_1}", "${name_0_2}", "${name_0_3}", "${name_0_4}", "${name_0_5}", "${name_0_6}", "${name_0_7}", "${name_0_8}", "${name_0_9}", "${name_0_10}"],
        ["${name_1_0}", "${name_1_1}", "${name_1_2}", "${name_1_3}", "${name_1_4}", "${name_1_5}", "${name_1_6}", "${name_1_7}", "${name_1_8}", "${name_1_9}", "${name_1_10}"],
        ["${name_2_0}", "${name_2_1}", "${name_2_2}", "${name_2_3}", "${name_2_4}", "${name_2_5}", "${name_2_6}", "${name_2_7}", "${name_2_8}", "${name_2_9}", "${name_2_10}"],
        ["${name_3_0}", "${name_3_1}", "${name_3_2}", "${name_3_3}", "${name_3_4}", "${name_3_5}", "${name_3_6}", "${name_3_7}", "${name_3_8}", "${name_3_9}", "${name_3_10}"],
        ["${name_4_0}", "${name_4_1}", "${name_4_2}", "${name_4_3}", "${name_4_4}", "${name_4_5}", "${name_4_6}", "${name_4_7}", "${name_4_8}", "${name_4_9}", "${name_4_10}"],
        ]

String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};


function replaceEverywhere(node, search, replacement) {
    if (node.nodeType === 3) { // Node.TEXT_NODE
        var text = node.data.replaceAll(search, replacement);
        if (text != node.data) // there's a Safari bug
            node.data = text;
    } else if (node.nodeType === 1) { // Node.ELEMENT_NODE
        if (node.name) {
            node.name = node.name.replaceAll(search, replacement);
        }
        if (node.id) {
            node.id = node.id.replaceAll(search, replacement);
        }
        if (node.title) {
            node.title = node.title.replaceAll(search, replacement);
        }
        if (node.src) {
            node.src = node.src.replaceAll(search, replacement);
        }
        for (var i = 0; i < node.childNodes.length; i++) {
            replaceEverywhere(node.childNodes[i], search, replacement); // run recursive on DOM
        }
    }
};

var num_images = 0;

document.addEventListener('DOMContentLoaded', function(){

    var img_form_template = document.getElementById("IMG#-form");
    img_form_template.parentNode.removeChild(img_form_template);

    var num_names_total = 0;

    for (var i = 0; i < images.length; i++) {

        var img = images[i].trim();
        if (img != "") {

            num_images += 1;

            var num_names = 0;

            img_form = img_form_template.cloneNode(true);
            replaceEverywhere(img_form, "IMG#", "IMG"+i);
            replaceEverywhere(img_form, "http://img_url_placeholder/", img);

            document.getElementById("form_main").appendChild(img_form);

            var name_form_template = document.getElementById("IMG"+i+"-NAME#-form");
            name_form_template.parentNode.removeChild(name_form_template);

            var name_form2_template = document.getElementById("IMG"+i+"-NAME#-form2");
            name_form2_template.parentNode.removeChild(name_form2_template);

            for (var n = 0; n < names[i].length; n++) {
                var name = names[i][n].trim();
                if (name != "") {

                    num_names += 1;
                    num_names_total += 1;

                    name_form = name_form_template.cloneNode(true);
                    replaceEverywhere(name_form, "NAME#", "NAME"+n);
                    replaceEverywhere(name_form, "NAME_PLACEHOLDER", name);
                    document.getElementById("IMG"+i+"-form-table").appendChild(name_form);

                    name_form2 = name_form2_template.cloneNode(true);
                    replaceEverywhere(name_form2, "NAME#", "NAME"+n);
                    replaceEverywhere(name_form2, "NAME_PLACEHOLDER", name);
                    document.getElementById("IMG"+i+"-form2-table").appendChild(name_form2);

                }
            }

            // Remove superfluous color buttons
            for (var n = 0; n < num_names; n++) {
                for (var m = num_names; m < names[0].length - 1; m++) {
                    console.log("Attempting to delete: " + "IMG"+i+"-"+"NAME"+n+"-label-color"+m);
                    colorbutton = document.getElementById("IMG"+i+"-"+"NAME"+n+"-label-color"+m);
                    colorbutton.parentNode.removeChild(colorbutton);
                }
            }
        }
    }

    document.getElementById("num_names").innerHTML = num_names_total;
    document.getElementById("num_images").innerHTML = num_images;


})


function showhide(e) {

    basename = e.name.split('-');
    basename = basename[0] + '-' + basename[1];

    if (e.checked & e.value == 0) {
        document.getElementById(basename + '-subform').style.visibility = 'hidden';
        buttons = document.getElementsByName(basename + '-type');
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].disabled = true;
        }
    } else if (e.checked & e.value >= 1) {
        document.getElementById(basename + '-subform').style.visibility = 'visible';
        if (e.value == 1) {
            document.getElementById(basename + '-subform').style.background = "#fea";
        } else {
            document.getElementById(basename + '-subform').style.background = "#fcc";
        }
        buttons = document.getElementsByName(basename + '-type');
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].disabled = false;
        }
    }

}

function uncheck(buttons) {
    for (var i=0; i<buttons.length; i++) {
        buttons[i].checked = false;
    }
}

$(window).scroll(function() {
  for (var i = 0; i < num_images; i++) {
      var scrollTop= $(window).scrollTop(),
          b1= $("#IMG"+i+"-form"),
          b2= $("#IMG"+i+"-fixedbox"),
          min= b1.position().top + 150,
          max= (b1.position().top + b1.outerHeight()) - b2.outerHeight() - 150;

      b2.css({
        top: Math.min(Math.max(scrollTop,min),max) - scrollTop
      });
  }
});


</script>


<style>


.box1 {
}
.box2 {
    position:fixed;
}

span.boundingbox {
    border:3px;
    border-style:solid;
    border-color:#f00;
    padding:0px;
}

.intro {
    font-size: 14pt;
}


/* Thanks to http://jsfiddle.net/dujtbh5f/ kamil335 for the following: */

.hover{
    text-align:center;
    width:150px;
    position:relative;
    border: 1px dashed #c00;
}

.tooltip{
    display:none;
    position:absolute;
    background-color:white;
    border:1px solid red;
    border-radius: 5px;
    padding:3px;
    font-size: 12pt;
    top:30px;
    left:-250px;
    width:500px;
    font-weight: normal;
    text-align: left;
}

.hover:hover .tooltip{
    display:block;
}

.hover:hover {
    cursor:help;
}


.column {
  float: left;
  padding: 20pt;
}
.left {
  width: 65%;
}
.right {
  width: 25%;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}


img.picture {
  width: 100%;
  border: 4px solid #ccc;
}


.formtable, .formtable2 {
  background-color: #eee;
  width: 100%;
  border:4px solid #ccc;
  background-color: #eee;
  border-collapse: collapse;
}

.formtable th, .formtable td {
    text-align: center;
}
.formtable2 th, .formtable2 td {
    text-align: left;
}
th {
    font-weight: bold;
    font-size: 14pt;
    padding: 5pt;
}
th, .formtable td {
    border-bottom: 4px solid #ccc;
}


td.name, th.name {
    width: 20%;
}
td.name {
    font-family: monospace;
    font-size: 16pt;
}

td.rating, th.rating {
    width: 10%;
    text-align: left;
}
td.rating {
    height: 3vw;
}


td.type, th.type {
    width: 70%;
}
td.type {
    height: 3vw;
    visibility: hidden;
    font-size: 10pt;
    text-align: center;
}

td.color, th.color {
    width: 80%;
}


div.caption {
    width: 20%;
    padding: 3pt;
    display: inline-block;
    text-align: center;
    font-size: 12pt;
}

.required:after { content:" *"; }


/* HIDE RADIO */
[type=radio] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

/* IMAGE STYLES */
[type=radio] + img.type {
  cursor: pointer;
  height: 5vw;
  margin: 3pt;
  margin-bottom: 5pt;
  outline: 2pt solid #aaa;
}

/* CHECKED STYLES */
[type=radio]:checked + img.type {
  outline: 6pt solid #666;
}

/* IMAGE STYLES */
[type=radio] + img.emote {
  cursor: pointer;
  height: 100%;
  margin: 3pt;
}

/* CHECKED STYLES */
[type=radio]:checked + img.emote {
  outline: 6pt solid #666;
}

label {
    cursor: pointer;
}

div.color {
  width: 3vw;
  height: 2.5vw;
  font-size: 2vw;
  text-align: center;
  font-weight: bold;
  padding-top: .5vw;
  opacity: 1;
  display: inline-block;
  outline: 2pt solid #000;
}

/* COLOR STYLES */
[type=radio] + div.color {
  cursor: pointer;
  opacity: .2;
}

/* CHECKED STYLES */
[type=radio]:checked + div.color {
  opacity: 1;
}


</style>

<!-- Notes -->



<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects" id="form_main">

    <h2>How (not) to name an object.</h2>

    <p class="intro">
        We asked various workers to <i style="color:#0020C2;">"please name the object in the bounding box"</i>, for a number of images.<br>
        We need you to evaluate the names we got:
    </p>
    <ul class="intro" style="margin-top:-10pt">
        <li>Is each <b>name adequate?</b> (See definition of "adequate" below.)</li>
        <li>If not, <b>what's wrong?</b> Did they enter a word that doesn't apply to object they intended to name? Did they name an object that doesn't fit tightly in the bounding box? Did they misinterpret the picture? Something else?</li>
        <li>And <b>which object</b>, exactly, did the different workers intend to name?</li>
    </ul>

    <p class="intro">
        When judging if a name is "adequate", you <i>must</i> use the following definition:
    </p>
        <div class="intro" style="background-color: #ddd; margin: 10pt; padding: 10pt;">
        <b>Definition:</b> A name is "adequate" if there is an object in the picture, <i>tightly</i> circumscribed by the red bounding box, that one could reasonably call by that name.
        <br>
        Note: Sometimes parts of the object are not visible -- for instance parts which are behind some other object, or which fall outside the picture frame. Such invisible parts are allowed to be outside the bounding box.
        </div>

    <p class="intro">
        For full instructions and examples click the button underneath each picture below. You can also hover your mouse over a button for clarification.
    </p>

    <p class="intro">
        In this HIT you will get <span id="num_images"></span> images, with a total <span id="num_names"></span> names.
        <br>
        This batch of HITs contains quality control items. <b>Submitting too many low-quality responses will lead to rejection of all your HITs in this batch.</b>
    </p>

    <div class="row" id="IMG#-form">

        <hr style="border: 0pt; border-top: 2pt solid #eee; border-bottom: 2pt solid #bbb; background-color: #ddd; height: 20px;">

        <div class="column left">

            <h3>&#9658; Are the following names <span class="hover">adequate<div class="tooltip">
                <b>Definition:</b> A name is "adequate" if there is an object in the picture, <i>tightly</i> circumscribed by the red bounding box, that you could reasonably call by that name.<br><br>
                Invisible parts of the object -- for instance parts which are obscured by another object, or which fall outside the picture frame -- are allowed to fall outside the bounding box.
                </div></span>
                for the picture on the right? If not, what's wrong?</h3>

            <table class="formtable" id="IMG#-form-table">

                <tr>
                    <th class="name">Name given:</th>
                    <th class="rating">Adequate?</th>
                    <th class="type">If not, what is (or could be) inadequate about the name, primarily?</th>
                </tr>


                <tr id="IMG#-NAME#-form">
                    <td class="name">
                        NAME_PLACEHOLDER
                    </td>
                    <td class="rating">
                        <label><input required type="radio" name="IMG#-NAME#-rating" id="IMG#-NAME#-rating.0" value="0" onclick="showhide(this);" />
                            <img class="emote" name='emote0' src="http://mwestera.humanities.uva.nl/images/em-certain.png" title="Perfectly adequate; there's a suitable object for the name, tightly circumscribed by the red bounding box." /></label> <br>
                        <label><input required type="radio" name="IMG#-NAME#-rating" id="IMG#-NAME#-rating.1" value="1" onclick="showhide(this);" />
                            <img class="emote" name='emote1' src="http://mwestera.humanities.uva.nl/images/em-bit-uncertain.png" title="There may be a (slight) inadequacy..." /></label> <br>
                        <label><input required type="radio" name="IMG#-NAME#-rating" id="IMG#-NAME#-rating.2" value="2" onclick="showhide(this);" />
                            <img class="emote" name='emote2' src="http://mwestera.humanities.uva.nl/images/em-super-uncertain.png" title="Clearly inadequate; simply no suitable object(s) for the name or vice versa." /></label>
                    </td>
                    <td class="type" id='IMG#-NAME#-subform'>
                        <div class="caption">
                            <label title="The inadequacy seems to be purely linguistic, e.g., a confusion of similar words, not quite the right meaning, or a typo. IMPORTANT: Don't be a definition warrior; if other people could use the name this way, accept it."><input required type="radio" name="IMG#-NAME#-type" id="IMG#-NAME#-type.0" value="0" />
                                <img class="type" name="icon0" src="http://mwestera.humanities.uva.nl/images/pilot-icon1.png" />
                               <br>
                                Linguistic <br> mistake</label>
                        </div>
                        <div class="caption">
                            <label title="The name seems to pertain to an object that does not fit in the bounding box, or insufficiently tightly."><input required type="radio" name="IMG#-NAME#-type" id="IMG#-NAME#-type.1" value="1" />
                                <img class="type" name="icon1" src="http://mwestera.humanities.uva.nl/images/pilot-icon3.png"/>
                                <br>
                                Bounding box <br> error
                            </label>
                        </div>
                        <div class="caption">
                            <label title="The worker may have misinterpreted the picture, mistaking the object for something it is not, e.g., the picture is a bit unclear or they may need glasses."><input required type="radio" name="IMG#-NAME#-type" id="IMG#-NAME#-type.2" value="2" />
                                <img class="type" name="icon2" src="http://mwestera.humanities.uva.nl/images/pilot-icon2.png"/>
                                <br>
                                Picture <br> misinterpreted
                            </label>
                        </div>
                        <div class="caption">
                            <label title="Something else is going on, e.g., cat on keyboard, worker messing about, trolling, ..."><input required type="radio" name="IMG#-NAME#-type" id="IMG#-NAME#-type.3" value="3" />
                                <img class="type" name="icon3" src="http://mwestera.humanities.uva.nl/images/pilot-icon4.png"/>
                                <br>
                                Some other<br> inadequacy
                            </label>
                        </div>
                    </td>
                </tr>

            </table>

            <br>

            <h3>&#9658; If you had to guess, which names were likely intended for naming the same <span class="hover">object<div class="tooltip">By "object" we mean a real-world object visible in the picture; so not the red bounding box, or an image region, but a depicted, real object.</div></span>?</h3>

            <p>Sometimes different workers had different objects in mind when entering a name.
                Click below to <b>assign the same color to names that were likely intended for the same object</b> (regardless of whether the names were adequate correct or not).
                Assign different colors to names that were likely intended for different objects.
                Choose "?" if you are really uncertain about what object the name was intended for.</p>


            <table class="formtable2" id="IMG#-form2-table">
                <tr>
                    <th class="name">Names:</th>
                    <th class="color">Assign the same color (only) if names were likely intended for the same object:</th>
                </tr>

                <tr id="IMG#-NAME#-form2">
                    <td class="name">NAME_PLACEHOLDER</td>
                    <td class="color">
                        <label id="IMG#-NAME#-label-color0"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.0" value="0" checked/>
                            <div class="color" name="color0" style="background-color: #f60" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color1"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.1" value="1"/>
                            <div class="color" name="color1" style="background-color: #00f" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color2"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.2" value="2"/>
                            <div class="color" name="color2" style="background-color: #093" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color3"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.3" value="3"/>
                            <div class="color" name="color3" style="background-color: #c0c" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color4"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.4" value="4"/>
                            <div class="color" name="color4" style="background-color: #c90" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color5"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.5" value="5"/>
                            <div class="color" name="color5" style="background-color: #069" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color6"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.6" value="6"/>
                            <div class="color" name="color6" style="background-color: #39f" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color7"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.7" value="7"/>
                            <div class="color" name="color7" style="background-color: #690" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color8"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.8" value="8"/>
                            <div class="color" name="color8" style="background-color: #c69" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        <label id="IMG#-NAME#-label-color9"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.9" value="9"/>
                            <div class="color" name="color9" style="background-color: #c90" title="Click to choose the color; assign identical colors to names that were likely intended to name the same object.">&nbsp;</div></label>
                        &nbsp;&nbsp;&nbsp;
                        <label id="IMG#-NAME#-label-colorX"><input required type="radio" name="IMG#-NAME#-color" id="IMG#-NAME#-color.X" value="X"/>
                            <div class="color" name="colorX" style="background-color: #999" title="Click here if you really don't know which object this name was meant to apply to.">?</div></label>
                    </td>
                </tr>

            </table>

            <br>

            <h3>&#9658; Any comments? [Optional]</h3>
            <input type="text" name="IMG#-comment" style="width:50%; font-size:16pt; padding:5pt" maxlength="100"/>

        </div>

        <div class="column right">

            <div class="box2" id="IMG#-fixedbox">
                <img class="picture" src="http://img_url_placeholder/"/>

                <br><br> <i style="font-size:18pt;">Need help?  &#10233;</i>

                <crowd-instructions link-type="button">

                    <short-summary>
                        [summary here]
                    </short-summary>

                    <positive-example>
                        [positive examples here]
                    </positive-example>

                    <negative-example>
                        [negative examples here]
                    </negative-example>

                    <detailed-instructions>
                        [detailed instructions here]
                    </detailed-instructions>

                </crowd-instructions>
            </div>

        </div>
    </div>


</crowd-form>
